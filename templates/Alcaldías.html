{% extends "base.html" %}

{% block title %}
  Sistema de Recolección de Basura
{% endblock title %}

{% block content %}
<div class="form-container">
  <h2>Sistema de Recolección de Basura</h2>

  <!-- Selección de alcaldía -->
  <form method="POST" action="{{ url_for('seleccionar_alcaldia') }}" id="alcaldiaForm" class="post">
    <table class="form-table">
      <tr>
        <td><label for="alcaldía">Alcaldía:</label></td>
        <td>
          <select name="alcaldía" id="alcaldía" class="seleccionador-opciones" required>
            <option value="" disabled {% if not seleccionada %}selected{% endif %}>Selecciona una alcaldía</option>
            {% for alc in alcaldías %}
              <option value="{{ alc }}" {% if alc == seleccionada %}selected{% endif %}>{{ alc }}</option>
            {% endfor %}
          </select>
        </td>
      </tr>
    </table>
  </form>

  {% if seleccionada %}
    <!-- Formulario para camiones y parámetros -->
    <form method="POST" action="{{ url_for('progreso_agrupamiento', alcaldia=seleccionada) }}" id="datosForm" class="post">
      <h3>Agregar Camiones para {{ seleccionada }}</h3>
      <table class="form-table" id="camionesTable">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Capacidad</th>
            <th>Factor de Reserva</th>
            <th>Cantidad de Camiones</th>
            <th>
              <button type="button" id="addCamionBtn">+</button>
              <button type="button" id="removeCamionBtn">-</button>
            </th>
          </tr>
        </thead>
        <tbody id="camionesContainer">
          <tr>
            <td><input type="text" name="camiones[0][nombre]" required></td>
            <td><input type="text" name="camiones[0][capacidad]" min="0" required inputmode="decimal" 
                       oninput="this.value = this.value.replace(/[^0-9.]/g, '');"></td>
            <td><input type="text" name="camiones[0][factor_reserva]" min="0" required inputmode="decimal" 
                       oninput="this.value = this.value.replace(/[^0-9.]/g, '');"></td>
            <td><input type="text" name="camiones[0][cantidad_camiones]" min="0" required inputmode="numeric" 
                       oninput="this.value = this.value.replace(/[^0-9]/g, '');"></td>
            <td></td>
          </tr>
        </tbody>
      </table>

      <h3>Parámetros para la Agrupación de {{ seleccionada }}</h3>
      <table class="form-table">
        <tr>
          <td><label for="tamano_poblacion">Tamaño de Población:</label></td>
          <td><input type="text" name="agrupamiento[tamano_poblacion]" min="0" required inputmode="numeric"
                     oninput="this.value = this.value.replace(/[^0-9]/g, '');"></td>
        </tr>
        <tr>
          <td><label for="num_generaciones">Número de Generaciones:</label></td>
          <td><input type="text" name="agrupamiento[num_generaciones]" min="0" required inputmode="numeric"
                     oninput="this.value = this.value.replace(/[^0-9]/g, '');"></td>
        </tr>
        <tr>
          <td><label for="tasa_mutacion">Tasa de Mutación:</label></td>
          <td><input type="text" name="agrupamiento[tasa_mutacion]" min="0" max="1" required inputmode="decimal"
                     oninput="this.value = this.value.replace(/[^0-9.]/g, '');"></td>
        </tr>
        <tr>
          <td><label for="factor_basura">Factor de Basura:</label></td>
          <td><input type="text" name="agrupamiento[factor_basura]" min="0" required inputmode="decimal"
                     oninput="this.value = this.value.replace(/[^0-9.]/g, '');"></td>
        </tr>
      </table>

      <div class="enviar-boton">
        <button type="submit" class="btn">Iniciar Agrupamiento</button>
      </div>
    </form>
  {% endif %}
</div>

<script src="{{ url_for('static', filename='js/alcaldias.js') }}"></script>
{% endblock content %}